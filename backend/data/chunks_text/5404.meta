{"original_code": "def test_TilerFactory_WithDependencies():\n    \"\"\"Test TilerFactory class.\"\"\"\n\n    http_basic = security.HTTPBasic()\n\n    def must_be_bob(credentials: security.HTTPBasicCredentials = Depends(http_basic)):\n        if credentials.username == \"bob\":\n            return True\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"You're not Bob\",\n            headers={\"WWW-Authenticate\": \"Basic\"},\n        )\n\n    cog = TilerFactory(\n        route_dependencies=[\n            (\n                [\n                    {\"path\": \"/bounds\", \"method\": \"GET\"},\n                    {\"path\": \"/tiles/{z}/{x}/{y}\", \"method\": \"GET\"},\n                ],\n                [Depends(must_be_bob)],\n            ),\n        ],\n        router_prefix=\"something\",\n    )\n    assert len(cog.router.routes) == 27\n\n    app = FastAPI()\n    app.include_router(cog.router, prefix=\"/something\")\n    client = TestClient(app)\n\n    auth_bob = httpx.BasicAuth(username=\"bob\", password=\"ILoveSponge\")\n    auth_notbob = httpx.BasicAuth(username=\"notbob\", password=\"IHateSponge\")\n\n    response = client.get(f\"/something/tilejson.json?url={DATA_DIR}/cog.tif\")\n    assert response.status_code == 200\n    assert response.headers[\"content-type\"] == \"application/json\"\n    assert response.json()[\"tilejson\"]\n\n    response = client.get(\n        f\"/something/bounds?url={DATA_DIR}/cog.tif&rescale=0,1000\", auth=auth_bob\n    )\n    assert response.status_code == 200\n\n    response = client.get(\n        f\"/something/bounds?url={DATA_DIR}/cog.tif&rescale=0,1000\", auth=auth_notbob\n    )\n    assert response.status_code == 401\n    assert response.json()[\"detail\"] == \"You're not Bob\"\n\n    response = client.get(\n        f\"/something/tiles/8/87/48?url={DATA_DIR}/cog.tif&rescale=0,1000\", auth=auth_bob\n    )\n    assert response.status_code == 200\n    assert response.headers[\"content-type\"] == \"image/jpeg\"\n\n    response = client.get(\n        f\"/something/tiles/8/87/48?url={DATA_DIR}/cog.tif&rescale=0,1000\",\n        auth=auth_notbob,\n    )\n    assert response.status_code == 401\n    assert response.json()[\"detail\"] == \"You're not Bob\"\n\n    response = client.get(\n        f\"/something/tiles/8/87/48.jpeg?url={DATA_DIR}/cog.tif&rescale=0,1000\"\n    )\n    assert response.status_code == 200\n    assert response.headers[\"content-type\"] == \"image/jpeg\"\n\n    cog = TilerFactory(router_prefix=\"something\")\n    cog.add_route_dependencies(\n        scopes=[{\"path\": \"/bounds\", \"method\": \"GET\"}],\n        dependencies=[Depends(must_be_bob)],\n    )\n\n    app = FastAPI()\n    app.include_router(cog.router, prefix=\"/something\")\n    client = TestClient(app)\n\n    response = client.get(f\"/something/tilejson.json?url={DATA_DIR}/cog.tif\")\n    assert response.status_code == 200\n    assert response.headers[\"content-type\"] == \"application/json\"\n    assert response.json()[\"tilejson\"]\n\n    response = client.get(\n        f\"/something/bounds?url={DATA_DIR}/cog.tif&rescale=0,1000\", auth=auth_bob\n    )\n    assert response.status_code == 200\n\n    response = client.get(\n        f\"/something/bounds?url={DATA_DIR}/cog.tif&rescale=0,1000\", auth=auth_notbob\n    )\n    assert response.status_code == 401\n    assert response.json()[\"detail\"] == \"You're not Bob\""}