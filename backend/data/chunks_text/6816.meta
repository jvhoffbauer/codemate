{"original_code": "def create_user(*, session: SessionDep, user_in: UserCreate) -> UserOut:\n    \"\"\"\n    Create new user.\n    \"\"\"\n    user = crud.get_user_by_email(session=session, email=user_in.email)\n    if user:\n        raise HTTPException(\n            status_code=400,\n            detail=\"The user with this username already exists in the system.\",\n        )\n\n    user = crud.create_user(session=session, user_create=user_in)\n    if settings.EMAILS_ENABLED and user_in.email:\n        send_new_account_email(\n            email_to=user_in.email, username=user_in.email, password=user_in.password\n        )\n    return user  # type: ignore"}