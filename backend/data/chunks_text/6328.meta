{"original_code": "async def register_new_user(\n    new_user: UserCreateRequest,\n    session: AsyncSession = Depends(deps.get_session),\n):\n    \"\"\"Create new user\"\"\"\n    result = await session.execute(select(User).where(User.email == new_user.email))\n    if result.scalars().first() is not None:\n        raise HTTPException(status_code=400, detail=\"Cannot use this email address\")\n    user = User(\n        email=new_user.email,\n        hashed_password=get_password_hash(new_user.password),\n    )\n    session.add(user)\n    await session.commit()\n    return user"}