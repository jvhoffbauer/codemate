{"original_code": "@needs_py39\ndef test_websocket_with_header(app: FastAPI):\n    client = TestClient(app)\n    with pytest.raises(WebSocketDisconnect):\n        with client.websocket_connect(\"/items/bar/ws?token=some-token\") as websocket:\n            message = \"Message one\"\n            websocket.send_text(message)\n            data = websocket.receive_text()\n            assert data == \"Session cookie or query token value is: some-token\"\n            data = websocket.receive_text()\n            assert data == f\"Message text was: {message}, for item ID: bar\"\n            message = \"Message two\"\n            websocket.send_text(message)\n            data = websocket.receive_text()\n            assert data == \"Session cookie or query token value is: some-token\"\n            data = websocket.receive_text()\n            assert data == f\"Message text was: {message}, for item ID: bar\""}