{"original_code": "@pytest.mark.asyncio\nasync def test_register_email_taken(\n    client: TestClient, monkeypatch: pytest.MonkeyPatch\n) -> None:\n    from src.auth.dependencies import service\n\n    async def fake_getter(*args, **kwargs):\n        return True\n\n    monkeypatch.setattr(service, \"get_user_by_email\", fake_getter)\n\n    resp = await client.post(\n        \"/auth/users\",\n        json={\n            \"email\": \"email@fake.com\",\n            \"password\": \"123Aa!\",\n        },\n    )\n    resp_json = resp.json()\n\n    assert resp.status_code == status.HTTP_400_BAD_REQUEST\n    assert resp_json[\"detail\"] == ErrorCode.EMAIL_TAKEN"}