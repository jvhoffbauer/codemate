{"original_code": "def test_ep_middleware_exit(ep, raw_request):\n    @contextlib.asynccontextmanager\n    async def middleware(_ctx: JsonRpcContext):\n        yield\n        raise HTTPException(401)\n\n    ep.middlewares.append(middleware)\n\n    @ep.method()\n    def probe() -> str:\n        return \"qwe\"\n\n    resp = raw_request(\n        json_dumps(\n            {\n                \"id\": 1,\n                \"jsonrpc\": \"2.0\",\n                \"method\": \"probe\",\n                \"params\": {},\n            }\n        )\n    )\n\n    assert resp.status_code == 401\n    assert resp.json() == {\"detail\": \"Unauthorized\"}"}