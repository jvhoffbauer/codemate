{"original_code": "        @self.router.get(\n            r\"/crop/{minx},{miny},{maxx},{maxy}.{format}\",\n            **img_endpoint_params,\n        )\n        @self.router.get(\n            r\"/crop/{minx},{miny},{maxx},{maxy}/{width}x{height}.{format}\",\n            **img_endpoint_params,\n        )\n        def part(\n            minx: float = Path(..., description=\"Bounding box min X\"),\n            miny: float = Path(..., description=\"Bounding box min Y\"),\n            maxx: float = Path(..., description=\"Bounding box max X\"),\n            maxy: float = Path(..., description=\"Bounding box max Y\"),\n            format: ImageType = Query(..., description=\"Output image type.\"),\n            src_path=Depends(self.path_dependency),\n            layer_params=Depends(self.layer_dependency),\n            dataset_params=Depends(self.dataset_dependency),\n            image_params=Depends(self.img_dependency),\n            post_process=Depends(self.process_dependency),\n            rescale: Optional[List[Tuple[float, ...]]] = Depends(RescalingParams),\n            color_formula: Optional[str] = Query(\n                None,\n                title=\"Color Formula\",\n                description=\"rio-color formula (info: https://github.com/mapbox/rio-color)\",\n            ),\n            colormap=Depends(self.colormap_dependency),\n            render_params=Depends(self.render_dependency),\n            reader_params=Depends(self.reader_dependency),\n            env=Depends(self.environment_dependency),\n        ):\n            \"\"\"Create image from part of a dataset.\"\"\"\n            with rasterio.Env(**env):\n                with self.reader(src_path, **reader_params) as src_dst:\n                    image = src_dst.part(\n                        [minx, miny, maxx, maxy],\n                        **layer_params,\n                        **image_params,\n                        **dataset_params,\n                    )\n                    dst_colormap = getattr(src_dst, \"colormap\", None)\n\n            if post_process:\n                image = post_process(image)\n\n            if rescale:\n                image.rescale(rescale)\n\n            if color_formula:\n                image.apply_color_formula(color_formula)\n\n            if cmap := colormap or dst_colormap:\n                image = image.apply_colormap(cmap)\n\n            content = image.render(\n                img_format=format.driver,\n                **format.profile,\n                **render_params,\n            )\n\n            return Response(content, media_type=format.mediatype)"}