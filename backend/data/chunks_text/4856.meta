{"original_code": "@router.post(\"/open\", response_model=User)\ndef create_user_open(\n    *,\n    username: str = Body(...),\n    password: str = Body(...),\n    email: EmailStr = Body(None),\n    full_name: str = Body(None),\n):\n    \"\"\"\n    Create new user without the need to be logged in.\n    \"\"\"\n    if not config.USERS_OPEN_REGISTRATION:\n        raise HTTPException(\n            status_code=403,\n            detail=\"Open user resistration is forbidden on this server\",\n        )\n    bucket = get_default_bucket()\n    user = crud.user.get(bucket, username=username)\n    if user:\n        raise HTTPException(\n            status_code=400,\n            detail=\"The user with this username already exists in the system\",\n        )\n    user_in = UserCreate(\n        username=username, password=password, email=email, full_name=full_name\n    )\n    user = crud.user.upsert(bucket, user_in=user_in, persist_to=1)\n    if config.EMAILS_ENABLED and user_in.email:\n        send_new_account_email(\n            email_to=user_in.email, username=user_in.username, password=user_in.password\n        )\n    return user"}