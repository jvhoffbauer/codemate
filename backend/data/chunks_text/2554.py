- Defines a function `wrapped_app` that wraps around the main application (`app`) for handling web socket requests. - Checks whether the request is of type 'websocket' and returns the result of calling the original application with the same arguments otherwise. - Creates an instance of `WebSocket` class using the given `scope`, `receive`, and `send` objects. - Calls the middleware function `middleware_func` passing in the created `WebSocket` object and the result of calling the original application as its second argument.