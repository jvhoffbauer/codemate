{"original_code": "def upsert_in_db(bucket: Bucket, *, user_in: UserCreate, persist_to=0):\n    user_doc_id = get_doc_id(user_in.username)\n    passwordhash = get_password_hash(user_in.password)\n    user = UserInDB(**user_in.dict(), hashed_password=passwordhash)\n    doc_data = jsonable_encoder(user)\n    with bucket.durability(\n        persist_to=persist_to, timeout=config.COUCHBASE_DURABILITY_TIMEOUT_SECS\n    ):\n        bucket.upsert(user_doc_id, doc_data)\n    return user"}