{"original_code": "def update_in_db(bucket: Bucket, *, username: str, user_in: UserUpdate, persist_to=0):\n    user_doc_id = get_doc_id(username)\n    stored_user = get(bucket, username=username)\n    stored_user = stored_user.copy(update=user_in.dict(skip_defaults=True))\n    if user_in.password:\n        passwordhash = get_password_hash(user_in.password)\n        stored_user.hashed_password = passwordhash\n    data = jsonable_encoder(stored_user)\n    with bucket.durability(\n        persist_to=persist_to, timeout=config.COUCHBASE_DURABILITY_TIMEOUT_SECS\n    ):\n        bucket.upsert(user_doc_id, data)\n    return stored_user"}